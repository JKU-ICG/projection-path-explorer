<html>

<body>
    <div id='viz'></div>
</body>

<script src='https://d3js.org/d3.v5.min.js'></script>
<script>
    var width = 800;
    var height = 600;
    var color = d3.scaleOrdinal(d3.schemeCategory10);


    var graph = {
        "nodes": [
            {
                "id": "Myriel"
            },
            {
                "id": "Napoleon"
            },
            {
                "id": "Mlle.Baptistine"
            },
            {
                "id": "Mme.Magloire"
            },
            {
                "id": "CountessdeLo"
            }
        ]
    }
    var label = {
        'nodes': [],
        'links': []
    };

    graph.nodes.forEach(function (d, i) {
        label.nodes.push({ node: d });
        label.nodes.push({ node: d });
        label.links.push({
            source: i * 2,
            target: i * 2 + 1
        });
    });

    var labelLayout = d3.forceSimulation(label.nodes)
        .force("charge", d3.forceManyBody().strength(-50))
        .force("collide", d3.forceCollide().radius(10))
        .force("link", d3.forceLink(label.links).distance(50).strength(0.5));

    var graphLayout = d3.forceSimulation(graph.nodes)
        //.force("charge", d3.forceManyBody().strength(-30))
        //.force("center", d3.forceCenter(width / 2, height / 2))
        .force("collide", d3.forceCollide().radius(20))
        //.force("x", d3.forceX(width / 2).strength(1))
        //.force("y", d3.forceY(height / 2).strength(1))
        //.force("link", d3.forceLink(graph.links).id(function(d) {return d.id; }).distance(50).strength(1))
        .on("tick", ticked);




    var svg = d3.select("#viz").attr("width", width).attr("height", height);
    var container = svg.append("div");



    var node = container.append("div").attr("class", "nodes")
        .selectAll("div")
        .data(graph.nodes)
        .enter()
        .append("div")
        .style("width", 20)
        .style("height", 20)
        .style("position", "absolute")
        .style("background", "red")
        .attr("fill", function (d) { return color(0); })



    var labelNode = container.append("div").attr("class", "labelNodes")
        .selectAll("div")
        .data(label.nodes)
        .enter()
        .append("div")
        .text(function (d, i) { return i % 2 == 0 ? "" : d.node.id; })
        .style("position", "absolute")
        .style("fill", "#555")
        .style("font-family", "Arial")
        .style("font-size", 12)
        .style("pointer-events", "none"); // to prevent mouseover/drag capture


    function ticked(e) {

        
        node.call(updateNode);

        labelLayout.alphaTarget(0.5).restart();
        labelNode.each(function (d, i) {
            if (i % 2 == 0) {
                d.x = d.node.x;
                d.y = d.node.y;
            } else {
                var b = { width: 100 }
    
                var diffX = d.x - d.node.x;
                var diffY = d.y - d.node.y;
    
                var dist = Math.sqrt(diffX * diffX + diffY * diffY);
    
                var shiftX = b.width * (diffX - dist) / (dist * 2);
                shiftX = Math.max(-b.width, Math.min(0, shiftX));
                var shiftY = 16;
                this.setAttribute("transform", "translate(" + shiftX + "," + shiftY + ")");
            }
        });

        var k = 0.05 * this.alpha();
        
        node.each(function (o, i) {
            o.y += (200 - o.y) * k;
            o.x += (200 - o.x) * k;
        });

        labelNode.call(updateNode);

    }

    function fixna(x) {
        if (isFinite(x)) return x;
        return 0;
    }


    function updateNode(node) {
        node.style("left", function (d) {
            return fixna(d.x) + "px"
        })
        node.style("top", function (d) {
            return fixna(d.y) + "px"
        })
    }


</script>

</html>